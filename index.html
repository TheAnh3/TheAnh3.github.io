<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulář</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <style>
        .rounded {
            border-radius: .55rem !important;
        }
        .btn-primary {
            color: #66649c;
            background-color: transparent;
            border: 2px solid #66649c;
            font-weight: 600;
        }
        .btn-primary:hover {
            color: white;
            background-color: #66649c;
            border-color: #66649c;
        }
        .btn-primary:focus,
        .btn-primary.focus {
            box-shadow: 0 0 0 .2rem rgba(102, 100, 156, 0.6);
        }
        .btn-primary:not(:disabled):not(.disabled):active,
        .btn-primary:not(:disabled):not(.disabled).active,
        .show>.btn-primary.dropdown-toggle {
            color: white;
            background-color: #66649c;
            border-color: #66649c
        }
        .btn-primary:not(:disabled):not(.disabled):active:focus,
        .btn-primary:not(:disabled):not(.disabled).active:focus,
        .show>.btn-primary.dropdown-toggle:focus {
            box-shadow: 0 0 0 .2rem rgba(102, 100, 156, 0.6)
        }

        .form-group label {
            font-weight: 600;
        }

        .custom-checkbox .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #66649c!important;
        }
        .custom-checkbox .custom-control-input:checked:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 1px #fff, 0 0 0 0.2rem rgba(102, 100, 156, 0.25)
        }
        .custom-checkbox .custom-control-input:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 1px #fff, 0 0 0 0.2rem rgba(0, 0, 0, 0.25)
        }
        .custom-checkbox .custom-control-input:active ~ .custom-control-label::before {
            background-color: #d4d2ff; 
        }

        .form-control:focus {
            border-color: #66649c;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0px 0px 0px 2px rgba(102, 100, 156, 0.6);
        }
        .form-select {
            background: transparent;
            border: 1px solid #ced4da;
            border-radius: .25rem;
            transition: all 0.2s ease;
        }
        .form-select:hover {
            background: rgba(102, 100, 156, 0.05);
        }
        h3 {
            color: #9d9d9d;
        }
    </style>
</head>
<body class="bg-light">
    <div class="d-flex justify-content-center m-5">
        <div class="align-self-center bg-white shadow p-3 rounded" style="max-width: 600px;">

            <div class="row mb-4">
                <div class="col">
                    <h3 class="m-2">Objednávkový formulář</h3>
                </div>
                <div class="col-auto">
                    <img src="logo-ucetnina1.webp" alt="Company Logo" style="max-height: 50px;" class="m-2">
                </div>
            </div>

            <form id="myForm" action="https://hook.eu2.make.com/s35rz2nnxhj64sdmsgc3h2ooajupwh5t" method="POST" name="contact-form">
                <div id="personal-fields">
                    <!-- JMENO + PRIJMENI -->
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md mt-3">
                                <label for="firstname">Jméno</label>
                                <input class="form-control" type="text" id="firstname" name="firstname" placeholder="Jméno" required>
                            </div>
                            <div class="col-md mt-3">
                                <label for="lastname">Příjmení</label>
                                <input class="form-control" type="text" id="lastname" name="lastname" placeholder="Příjmení" required>
                            </div>
                        </div>
                    </div>
                    <!-- TEL -->
                    <div class="form-group">
                        <label for="tel">Telefon</label>
                        <input type="tel" class="form-control" id="tel" name="tel" placeholder="+420 123 456 789" onkeypress="return isNumberKey2(event)" required>
                    </div>
                    <!-- ICO -->
                    <div class="form-group">
                        <label for="ico">IČO</label>
                        <input class="form-control" type="text" id="ico" name="ico" placeholder="12345678" minlength="8" maxlength="8" onkeypress="return isNumberKey(event)" required>
                    </div>
                </div>
                <!-- EMAIL -->
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
                </div>
                <!-- SLUZBY -->
                <div class="form-group">
                    <label class="w-100" for="service">Služby</label>
                    <select class="form-select p-2" id="service" name="Sluzba">
                        <option value="Konzultaci" selected>Konzultaci</option>
                        <option value="Vygenerování daňového domicilu">Vygenerování daňového domicilu</option>
                        <option value="Zpracování daňového přiznání">Zpracování daňového přiznání</option>
                    </select>
                </div>
                <!-- CHECKBOXY -->
                <div class="form-check mt-4">
                    <div class="row">
                        <div class="col-md mt-4">
                            <select  class="form-select p-1" id="dph" name="dph">
                                <option value="Ne" selected>NEplátce DPH</option>
                                <option value="Ano">Plátce DPH</option>
                            </select>
                        </div>
                        <div class="col-md ml-3 mt-4">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="fakt_visible" />
                                <label class="custom-control-label" for="fakt_visible">Fakturu na firmu</label>
                            </div>
                            <input type="hidden" id="fakt_hidden" name="firma_faktura" value="Ne"/>
                        </div>
                        <div class="col-md ml-3 mt-4">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="nakup_visible" />
                                <label class="custom-control-label" for="nakup_visible">Už jsem u Vás nakupoval služby v minulosti</label>
                            </div>
                            <input type="hidden" id="nakup_hidden" name="Nakup v minulosti" value="Ne"/>
                        </div>
                    </div>
                </div>
                <div class="form-check mt-5">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="exampleCheck2" required/>
                        <label class="custom-control-label" for="exampleCheck2">Souhlasím s <a href="https://ucetnina1.cz/gdpr/" class="text-blue-600 hover:underline">podmínkami a zásady o zpracování osobních údajů.</a></label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Objednávám</button>
            </form>
        </div>
    </div>

    <script>
        const scriptURL = 'https://hook.eu2.make.com/s35rz2nnxhj64sdmsgc3h2ooajupwh5t';
        const form = document.forms['contact-form'];
        
        form.addEventListener('submit', e => {
            e.preventDefault(); // Prevent the default form submission behavior
            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
            .then(response => {
                alert("Formulář byl úspěšně odeslán! Brzo se Vám ozveme");
                // window.location.reload(); // Reload the page after alert
            })
            .catch(error => {
                console.error('Error!', error.message);
                alert('Nastala nějaká chyba při odeslání formuláře.');
            });
        });

        const termsCheckbox = document.getElementById('fakt_visible');
        const termsHidden = document.getElementById('fakt_hidden');

        termsCheckbox.addEventListener('change', function() {
            if (termsCheckbox.checked) {
                termsHidden.value = 'Ano';
            } else {
                termsHidden.value = 'Ne';
            }
        });

        function toggleFields() {
            const nakupCheckbox = document.getElementById('nakup_visible');
            const personalFields = document.getElementById('personal-fields');

            var fields = ['firstname','lastname','ico','tel'];

            if (nakupCheckbox.checked) {
                personalFields.style.display = 'none';  // Hide personal field
                fields.forEach((id)=>{
                    var d = document.getElementById(id);
                    d.removeAttribute('required');
                    d.value = '';
                });
            } else {
                personalFields.style.display = 'block'; // Show personal fields
                fields.forEach((id)=>{
                    var d = document.getElementById(id);
                    d.setAttribute('required',true);
                });
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            const nakupCheckbox = document.getElementById('nakup_visible');
            nakupCheckbox.addEventListener('change', toggleFields);
            document.getElementById('tel').addEventListener('input', function(e) {
                let input = e.target.value;

    // Check if the input starts with a "+"
    let isInternational = false;
    if (input.startsWith('+')) {
        isInternational = true;
        // Remove the "+" temporarily for formatting the digits
        input = input.substring(1);
    }

    // Remove any non-digit characters (ignores the "+" if present)
    input = input.replace(/\D/g, '');

    if(isInternational && input.length > 12){
        input = input.substring(0,12);
    }else if(!isInternational && input.length > 9){
        input = input.substring(0,9);
    }

    // Format the input as 123 456 7890 (or with international codes if needed)
    if(isInternational && input.length > 9){
        input = input.replace(/(\d{3})(\d{3})(\d{3})(\d+)/, '$1 $2 $3 $4');
    }
    if (input.length > 6) {
        input = input.replace(/(\d{3})(\d{3})(\d+)/, '$1 $2 $3');
    } else if (input.length > 3) {
        input = input.replace(/(\d{3})(\d+)/, '$1 $2');
    }

    // Add back the "+" if it was there
    if (isInternational) {
        input = '+' + input;
    }

    // Set the formatted value back to the input field
    e.target.value = input;
});

        });

        function isNumberKey(evt) { //TODO: Check on mobile
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;
            return true;
        }
        
        function isNumberKey2(evt) {
            var charCode = (evt.which) ? evt.which : evt.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode != 43 && charCode != 32)
                return false;
            return true;
        }
    </script>
</body>
</html>
