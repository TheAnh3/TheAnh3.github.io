<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulář</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <style>
        .rounded {
            border-radius: .55rem !important;
        }
        .btn-primary {
            color: #66649c;
            background-color: transparent;
            border: 2px solid #66649c;
            font-weight: 600;
        }
        .btn-primary:hover {
            color: white;
            background-color: #66649c;
            border-color: #66649c;
        }
        .btn-primary:focus,
        .btn-primary.focus {
            box-shadow: 0 0 0 .2rem rgba(102, 100, 156, 0.6);
        }
        .btn-primary:not(:disabled):not(.disabled):active,
        .btn-primary:not(:disabled):not(.disabled).active,
        .show>.btn-primary.dropdown-toggle {
            color: white;
            background-color: #66649c;
            border-color: #66649c
        }
        .btn-primary:not(:disabled):not(.disabled):active:focus,
        .btn-primary:not(:disabled):not(.disabled).active:focus,
        .show>.btn-primary.dropdown-toggle:focus {
            box-shadow: 0 0 0 .2rem rgba(102, 100, 156, 0.6)
        }

        .form-group label {
            font-weight: 600;
        }

        .custom-checkbox .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #66649c!important;
        }
        .custom-checkbox .custom-control-input:checked:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 1px #fff, 0 0 0 0.2rem rgba(102, 100, 156, 0.25);
        }
        .custom-checkbox .custom-control-input:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 1px #fff, 0 0 0 0.2rem rgba(0, 0, 0, 0.25);
        }
        .custom-checkbox .custom-control-input:active ~ .custom-control-label::before {
            background-color: #d4d2ff; 
        }

        .form-control:focus {
            border-color: #66649c;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0px 0px 0px 2px rgba(102, 100, 156, 0.6);
        }
        .form-select {
            background: transparent;
            border: 1px solid #ced4da;
            border-radius: .25rem;
            transition: all 0.2s ease;
        }
        .form-select:hover {
            background: rgba(102, 100, 156, 0.05);
        }
        h3 {
            color: #9d9d9d;
        }
        .custom-switch .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #66649c!important;
            border-color: #66649c;
        }
        .custom-switch .custom-control-input:checked:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 1px #fff, 0 0 0 0.2rem rgba(102, 100, 156, 0.25);
        }
        .custom-switch .custom-control-input:focus ~ .custom-control-label::before {
            box-shadow: 0 0 0 1px #fff, 0 0 0 0.2rem rgba(0, 0, 0, 0.25);
            border-color: rgba(0, 0, 0, 0.25);
        }
        .custom-switch .custom-control-input:active ~ .custom-control-label::before {
            background-color: #d4d2ff; 
        }
        #personal-fields {
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .custom-switch.custom-switch .custom-control-label {
            padding-left: 2rem;
            padding-bottom: 1.25rem;
        }

        .custom-switch.custom-switch .custom-control-label::before {
            height: 1.25rem;
            width: calc(1.75rem + 0.75rem);
            border-radius: 3rem;
        }

        .custom-switch.custom-switch .custom-control-label::after {
            width: calc(1.25rem - 4px);
            height: calc(1.25rem - 4px);
            border-radius: calc(2rem - (1.25rem / 2));
        }

        .custom-switch.custom-switch .custom-control-input:checked ~ .custom-control-label::after {
            transform: translateX(calc(1.5rem - 0.25rem));
        }
    </style>
</head>
<body class="bg-light">
    <div class="d-flex justify-content-center m-5">
        <div class="align-self-center bg-white shadow p-3 rounded" style="max-width: 600px;">

            <div class="row mb-4">
                <div class="col">
                    <h3 class="m-2">Objednávkový formulář</h3>
                </div>
                <div class="col-auto">
                    <img src="logo-ucetnina1.webp" alt="Company Logo" style="max-height: 50px;" class="m-2">
                </div>
            </div>

            <form id="myForm" method="POST" name="contact-form">
                <div class="form-group">
                    <div class="custom-control custom-switch">
                        <input class="custom-control-input" type="checkbox" id="nakup_visible">
                        <label class="custom-control-label" for="nakup_visible">Už jsem u Vás nakupoval služby v minulosti</label>
                        <input type="hidden" id="nakup_hidden" name="Nakup v minulosti" value="Ne"/>
                    </div>
                </div>
                <div id="personal-fields">
                    <!-- JMENO + PRIJMENI -->
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md mt-3">
                                <label for="firstname">Jméno</label>
                                <input class="form-control" type="text" id="firstname" name="firstname" placeholder="Jméno" required>
                            </div>
                            <div class="col-md mt-3">
                                <label for="lastname">Příjmení</label>
                                <input class="form-control" type="text" id="lastname" name="lastname" placeholder="Příjmení" required>
                            </div>
                        </div>
                    </div>
                    <!-- TEL -->
                    <div class="form-group">
                        <label for="tel">Telefon</label>
                        <input type="tel" class="form-control" id="tel" name="tel" placeholder="+420 123 456 789" required>
                    </div>
                    <!-- ICO -->
                    <div class="form-group">
                        <label for="ico">IČO</label>
                        <input class="form-control" type="text" id="ico" name="ico" placeholder="12345678" minlength="8" maxlength="8" required>
                    </div>
                </div>
                <!-- EMAIL -->
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
                </div>
                <!-- SLUZBY -->
                <div class="form-group">
                    <label class="w-100" for="service">Služby</label>
                    <select class="form-select p-2" id="service" name="sluzba" required>
                        <option value="" selected disabled>Loading</option>
                    </select>
                    <input type="hidden" id="service_id" name="sluzba_id" value=""/>
                    <input type="hidden" id="service_price" name="sluzba_cena" value=""/>
                </div>
                <!-- CHECKBOXY -->
                <div class="form-check mt-4">
                    <div class="row">
                        <div class="col-md mt-4">
                            <select  class="form-select p-1" id="dph" name="dph">
                                <option value="Ne" selected>NEplátce DPH</option>
                                <option value="Ano">Plátce DPH</option>
                            </select>
                        </div>
                        <div class="col-md ml-3 mt-4">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="fakt_visible" />
                                <label class="custom-control-label" for="fakt_visible">Fakturu na firmu</label>
                            </div>
                            <input type="hidden" id="fakt_hidden" name="firma_faktura" value="Ne"/>
                        </div>
                    </div>
                </div>
                <div class="form-check mt-5">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="exampleCheck2" required/>
                        <label class="custom-control-label" for="exampleCheck2">Souhlasím s <a href="https://ucetnina1.cz/gdpr/" class="text-blue-600 hover:underline">podmínkami a zásady o zpracování osobních údajů.</a></label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Objednávám</button>
            </form>
        </div>
    </div>
    <script>
        const scriptURL = 'https://hook.eu2.make.com/s35rz2nnxhj64sdmsgc3h2ooajupwh5t';
        const form = document.forms['contact-form'];
        
        form.addEventListener('submit', e => {
            e.preventDefault();
            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
            .then(response => {
                alert("Formulář byl úspěšně odeslán! Brzo se Vám ozveme");
                // window.location.reload(); // Reload the page after alert
            })
            .catch(error => {
                console.error('Error!', error.message);
                alert('Nastala nějaká chyba při odeslání formuláře.');
            });
        });

        const termsCheckbox = document.getElementById('fakt_visible');
        const termsHidden = document.getElementById('fakt_hidden');

        termsCheckbox.addEventListener('change', function() {
            if (termsCheckbox.checked) {
                termsHidden.value = 'Ano';
            } else {
                termsHidden.value = 'Ne';
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const nakupCheckbox = document.getElementById('nakup_visible');
            const personalFields = document.getElementById('personal-fields');
            var personalFields_height = personalFields.offsetHeight;
            personalFields.style.height = personalFields_height+'px';
            
            nakupCheckbox.addEventListener('change', ()=>{
                var fields = ['firstname','lastname','ico','tel'];

                if (nakupCheckbox.checked) {
                    personalFields.style.opacity = 0;
                    personalFields.style.visibility = 'hidden';
                    personalFields.style.height = '0px';

                    fields.forEach((id)=>{
                        var d = document.getElementById(id);
                        d.removeAttribute('required');
                        d.value = '';
                    });
                } else {
                    personalFields.style.opacity = 1;
                    personalFields.style.visibility = 'visible';
                    personalFields.style.height = personalFields_height+'px';

                    fields.forEach((id)=>{
                        var d = document.getElementById(id);
                        d.setAttribute('required',true);
                    });
                }
            });
            document.getElementById('ico').addEventListener('input',(e)=>{
                var input = e.target.value;
                input = input.replace(/\D/g, '');
                e.target.value = input;
            });
            document.getElementById('tel').addEventListener('input', function(e) {
                let input = e.target.value;
            let isInternational = false;
            if (input.startsWith('+')) {
                isInternational = true;
                input = input.substring(1);
            }
            input = input.replace(/\D/g, '');

            if(isInternational && input.length > 12){
                input = input.substring(0,12);
            }else if(!isInternational && input.length > 9){
                input = input.substring(0,9);
            }
            if(isInternational && input.length > 9){
                input = input.replace(/(\d{3})(\d{3})(\d{3})(\d+)/, '$1 $2 $3 $4');
            }
            if (input.length > 6) {
                input = input.replace(/(\d{3})(\d{3})(\d+)/, '$1 $2 $3');
            } else if (input.length > 3) {
                input = input.replace(/(\d{3})(\d+)/, '$1 $2');
            }
            if (isInternational) {
                input = '+' + input;
            }
            e.target.value = input;
        });

        // Fetch Products
            var arr = new Map();
            arr.set("Konzultaci",5544883424);
            arr.set("Vygenerování daňového domicilu",6622014193);
            arr.set("Zpracování daňového přiznání",6622014194);
            var arr2 = new Map();
            arr2.set("Konzultaci","500 Kc");
            arr2.set("Vygenerování daňového domicilu","5000 Kc");
            arr2.set("Zpracování daňového přiznání","2000 Kc");
            //var arr = products();
            var service = document.getElementById('service');
            service.textContent = '';

            arr.forEach((val,key)=>{
                var opt = document.createElement('option');
                opt.text = key;
                opt.value = key;
                service.appendChild(opt);
            });

            service.firstChild.setAttribute('selected',true);
            document.getElementById('service_id').value = arr.get(service.firstChild.value);
            document.getElementById('service_price').value = arr2.get(service.firstChild.value)
            service.addEventListener('change',(e)=>{
                document.getElementById('service_id').value = arr.get(e.target.value);
                document.getElementById('service_price').value = arr2.get(e.target.value)
            });
        });
    </script>
</body>
</html>
